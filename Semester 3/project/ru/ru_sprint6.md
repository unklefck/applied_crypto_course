# **Проект: MicroPKI - Документ с техническими требованиями (Спринт 6)**

**Цель спринта:** Реализовать механизм проверки цепочки сертификатов и набор клиентских инструментов, позволяющих генерировать CSR, запрашивать выпуск сертификата, выполнять полную проверку цепочки и проверку статуса отзыва (CRL + OCSP) с интеллектуальной логикой переключения.

---

## 1. Структура проекта и состояние репозитория

В код необходимо добавить модули проверки путей сертификации, логику проверки отзыва и клиентские CLI‑инструменты.

| ID       | Описание требования                                                                                                                                                                                                                                                                                                                                                                                                                                     | Приоритет |
|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------|
| **STR‑19** | В репозитории **обязательно** сохранить структуру, принятую в спринтах 1–5. Новые модули **обязательно** добавить для функциональности валидации и клиента:<br> • **Python:** `validation.py`, `revocation_check.py`, `client.py`.<br> • **Go:** `internal/validation/`, `internal/revocation/`, `internal/client/` и новый `cmd/micropki-client` (если клиент выделяется в отдельный бинарный файл) **либо** расширение существующего `micropki` CLI подкомандой `client`. | **Must**  |
| **STR‑20** | В `README.md` **обязательно** обновить разделы:<br> • Инструкции по генерации CSR и запросу сертификата (`client request-cert`).<br> • Как выполнить проверку цепочки сертификатов (`client validate`).<br> • Как проверить статус отзыва с помощью CRL и OCSP (`client check-status`).<br> • Описание логики приоритетов при проверке отзыва (сначала OCSP, при неудаче — CRL).                                                                                 | **Must**  |
| **STR‑21** | Если клиент выносится в отдельный бинарный файл (например, `micropki-client`), он **должен** собираться и устанавливаться вместе с основным инструментом `micropki`. К нему применяются те же стандарты кодирования и управления зависимостями.                                                                                                                                                         | **Should** |

---

## 2. Парсер командной строки (CLI)

CLI должен предоставлять полный набор клиентских команд для управления сертификатами и их проверки.

| ID        | Описание требования                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Приоритет |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------|
| **CLI‑25** | Инструмент **обязан** предоставлять подкоманду `client gen-csr`, которая генерирует закрытый ключ и запрос на подпись сертификата (PKCS#10 CSR) для конечного сертификата. <br> • **Аргументы:** <br>   - `--subject` — отличительное имя (DN).<br>   - `--key-type` — `rsa` или `ecc` (по умолчанию: `rsa`).<br>   - `--key-size` — для RSA: 2048 или 4096 (по умолч.: 2048); для ECC: 256 или 384 (по умолч.: 256).<br>   - `--san` — альтернативные имена субъекта (SAN) (формат как в спринте 2).<br>   - `--out-key` — файл для сохранения закрытого ключа (незашифрованный PEM) (по умолч.: `./key.pem`).<br>   - `--out-csr` — файл для сохранения CSR (PEM) (по умолч.: `./request.csr.pem`).<br> • Закрытый ключ **обязательно** сохраняется **незашифрованным** с правами доступа `0o600`. Должно выводиться предупреждение об этом. | **Must**  |
| **CLI‑26** | Инструмент **обязан** предоставлять подкоманду `client request-cert`, которая отправляет CSR в центр сертификации (через API репозитория) и получает выпущенный сертификат. <br> • **Аргументы:** <br>   - `--csr` — путь к файлу CSR (PEM).<br>   - `--template` — шаблон сертификата: `server`, `client`, `code_signing`.<br>   - `--ca-url` — базовый URL репозитория (например, `http://localhost:8080`).<br>   - `--out-cert` — выходной файл для сертификата (PEM) (по умолч.: `./cert.pem`).<br> • Инструмент **обязан** отправить CSR на конечную точку выпуска сертификатов CA (определена в **REPO‑15**).<br> • Инструмент **обязан** обрабатывать ошибки HTTP и выводить понятные сообщения. | **Must**  |
| **CLI‑27** | Инструмент **обязан** предоставлять подкоманду `client validate`, выполняющую полную проверку цепочки сертификатов. <br> • **Аргументы:** <br>   - `--cert` — путь к конечному сертификату (PEM).<br>   - `--untrusted` — опциональные промежуточные сертификаты (PEM, можно повторять или передать один файл с цепочкой).<br>   - `--trusted` — путь к доверенным корневым сертификатам (PEM‑набор) (по умолч.: `./pki/certs/ca.cert.pem`).<br>   - `--crl` — опционально, проверка по CRL (локальный файл или URL).<br>   - `--ocsp` — опционально, выполнить OCSP‑запрос.<br>   - `--mode` — `chain` (только проверка подписи/срока действия) или `full` (включая проверку отзыва) (по умолч.: `full`).<br> • Инструмент **обязан** выводить чёткий результат (успех/неудача) и перечень выполненных шагов проверки. | **Must**  |
| **CLI‑28** | Инструмент **обязан** предоставлять подкоманду `client check-status`, которая проверяет статус отзыва сертификата с использованием CRL и OCSP, причём сначала используется OCSP, а при его недоступности — CRL. <br> • **Аргументы:** <br>   - `--cert` — путь к сертификату (PEM).<br>   - `--ca-cert` — сертификат удостоверяющего центра (PEM).<br>   - `--crl` — опционально, конкретный файл CRL или URL.<br>   - `--ocsp-url` — опционально, переопределить URL OCSP‑ответчика (иначе берётся из расширения AIA сертификата).<br> • Инструмент **обязан** выводить статус: `good`, `revoked` или `unknown` с деталями (время и причина отзыва, если отозван). | **Must**  |
| **CLI‑29** | Существующая команда `ca issue-cert` **должна** быть расширена поддержкой флага `--csr` (в спринте 2 это было **Could**). В спринте 6 эта функциональность **обязательна** к реализации, чтобы CA мог принимать внешние CSR.                                                                                                                                                                                                                                                                                     | **Must**  |
| **CLI‑30** | Сервер репозитория **обязан** предоставить новую конечную точку для выпуска сертификатов (см. **REPO‑15**). Команда `client request-cert` **обязана** использовать эту точку.                                                                                                                                                                                                                                                                                                                         | **Must**  |

**Примеры вызова:**

```bash
# 1. Сгенерировать закрытый ключ и CSR для серверного сертификата
$ micropki client gen-csr \
    --subject "CN=app.example.com" \
    --key-type rsa \
    --key-size 2048 \
    --san dns:app.example.com \
    --san dns:api.example.com \
    --out-key ./app.key.pem \
    --out-csr ./app.csr.pem

# 2. Отправить CSR в CA и получить подписанный сертификат
$ micropki client request-cert \
    --csr ./app.csr.pem \
    --template server \
    --ca-url http://localhost:8080 \
    --out-cert ./app.cert.pem

# 3. Проверить цепочку сертификатов (с локальным хранилищем доверия)
$ micropki client validate \
    --cert ./app.cert.pem \
    --untrusted ./pki/certs/intermediate.cert.pem \
    --trusted ./pki/certs/ca.cert.pem \
    --crl http://localhost:8080/crl?ca=intermediate \
    --ocsp

# 4. Проверить статус отзыва сертификата (OCSP, при ошибке — CRL)
$ micropki client check-status \
    --cert ./app.cert.pem \
    --ca-cert ./pki/certs/intermediate.cert.pem
```

---

## 3. Базовая PKI‑реализация (движок проверки путей сертификации)

Механизм проверки путей должен реализовывать упрощённую версию алгоритма проверки путей из RFC 5280.

| ID       | Описание требования                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Приоритет |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------|
| **VAL‑1** | **Построение цепочки сертификатов:** Валидатор **обязан** уметь строить сертификационный путь от конечного сертификата до доверенного корневого. <br> • Входные данные: конечный сертификат, опциональный набор непроверенных промежуточных сертификатов, набор доверенных корневых сертификатов.<br> • Построитель **обязан** упорядочивать сертификаты так, чтобы каждый сертификат был выпущен следующим в цепочке.<br> • При наличии нескольких путей **рекомендуется** выбирать кратчайший валидный путь.<br> • Если ни одного пути построить не удалось, проверка **обязана** завершиться ошибкой с соответствующим сообщением. | **Must**  |
| **VAL‑2** | **Базовые проверки при валидации пути:** Для каждого сертификата в пути (исключая доверенный корневой) валидатор **обязан** выполнить следующие проверки:<br> • **Проверка подписи:** проверить подпись сертификата с использованием открытого ключа издателя.<br> • **Срок действия:** проверить, что текущее время (или заданное эталонное время) находится в интервале между `notBefore` и `notAfter`.<br> • **Базовые ограничения (Basic Constraints):** если сертификат является сертификатом УЦ (`CA=TRUE`), убедиться, что он используется как издатель; для конечных сертификатов (`CA=FALSE`) — что они не используются как издатели.<br> • **Ограничение длины пути:** если в сертификате УЦ присутствует `pathLenConstraint`, проверить, что количество подчинённых сертификатов УЦ не превышает это ограничение.<br> • **Ключевое использование (Key Usage):** для сертификатов УЦ проверить наличие флага `keyCertSign` (если расширение Key Usage критическое). Для конечных сертификатов проверить, что использование ключа соответствует предполагаемому назначению (например, `digitalSignature` для TLS‑клиента/сервера). | **Must**  |
| **VAL‑3** | **Ограничения на имена (Name Constraints) — опционально:** Валидатор **может** поддерживать ограничения на имена (разрешённые/запрещённые поддеревья) согласно RFC 5280. Для спринта 6 эта функция **необязательна**, но приветствуется.                                                                                                                                                                                                                          | **Could** |
| **VAL‑4** | **Проверка политик:** Валидатор **не обязан** обрабатывать политики сертификатов (расширения политик X.509). Этот аспект можно опустить.                                                                                                                                                                                                                                                                                    | **N/A**   |
| **VAL‑5** | **Результат проверки:** Валидатор **обязан** возвращать структурированный результат, содержащий:<br> • Общий статус (успех/неудача).<br> • Для каждого сертификата — пройденные/непройденные шаги проверки.<br> • Сообщения об ошибках для первого встреченного сбоя.                                                                                                                                                                                                                     | **Must**  |
| **VAL‑6** | **Обработка времени:** Валидатор **должен** принимать опциональный параметр `--validation-time` (по умолчанию — текущее системное время). Это позволяет тестировать работу с просроченными сертификатами.                                                                                                                                                                                                                            | **Should** |

---

## 4. Проверка отзыва (интеграция CRL и OCSP)

Клиентские инструменты должны выполнять проверку статуса отзыва с использованием CRL и OCSP, а также реализовывать определённую логику переключения между ними.

| ID       | Описание требования                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Приоритет |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------|
| **REV‑1** | **Проверка по CRL:** Валидатор **обязан** поддерживать проверку сертификата по списку отозванных сертификатов (CRL). <br> • Входные данные: CRL (PEM/DER) или URL для загрузки CRL.<br> • CRL **обязательно** проверяется на подпись, соответствие издателя и актуальность (поле `nextUpdate`).<br> • Если CRL устарел (`nextUpdate` < текущее время), **обязательно** выводится предупреждение, но CRL **может** всё равно использоваться (или проверка может завершаться ошибкой — настраиваемо).<br> • Серийный номер сертификата ищется в списке `revokedCertificates`; если найден — статус = `revoked` (с указанием причины и даты отзыва). | **Must**  |
| **REV‑2** | **Проверка по OCSP:** Валидатор **обязан** поддерживать проверку сертификата через OCSP. <br> • Входные данные: сертификат издателя, URL ответчика (из расширения AIA или указанный вручную).<br> • Инструмент **обязан** сформировать OCSP‑запрос (опционально с nonce) и отправить его ответчику.<br> • Ответ OCSP **обязательно** проверяется: подпись, валидность сертификата ответчика, соответствие nonce (если отправлялся).<br> • Из ответа извлекается статус (`good`, `revoked`, `unknown`).                                                                                         | **Must**  |
| **REV‑3** | **Логика приоритетов при проверке отзыва:** При выполнении `full`‑проверки (или отдельной команды `check-status`) инструмент **обязан** реализовать следующую логику:<br> 1. **Сначала OCSP:** Попытаться выполнить OCSP‑запрос, если URL OCSP‑ответчика доступен (из расширения AIA или указан пользователем).<br> 2. **Если OCSP успешен** (валидный ответ, статус `good` или `revoked`) — использовать этот результат.<br> 3. **Если OCSP недоступен** (ответчик недоступен, некорректный ответ, неверная подпись или статус `unknown`) — **переключиться на CRL**.<br> 4. **Если CRL успешен** (актуален, подпись верна, серийный номер не найден → `good`; найден → `revoked`) — использовать этот результат.<br> 5. **Если оба метода недоступны** — статус = `unknown` (или проверка завершается ошибкой). | **Must**  |
| **REV‑4** | **Разбор расширения AIA:** Клиент **обязан** уметь извлекать URI OCSP‑ответчика из расширения Authority Information Access (AIA) сертификата (если оно присутствует). Это используется для автоматического определения конечной точки OCSP.                                                                                                                                                                                                               | **Must**  |
| **REV‑5** | **Разбор точек распространения CRL:** Клиент **должен** уметь извлекать URI точки распространения CRL из расширения CRL Distribution Points (CDP) сертификата (если присутствует). Это позволяет автоматически загружать CRL.                                                                                                                                                                                                                              | **Should** |
| **REV‑6** | **Кэширование данных об отзыве:** Клиент **может** реализовать простое кэширование CRL и OCSP‑ответов для уменьшения числа сетевых запросов. Для спринта 6 это **опционально**.                                                                                                                                                                                                                                                                        | **Could** |

---

## 5. Расширения репозитория и CA для поддержки CSR

Для поддержки рабочего процесса `client request-cert` необходимо расширить сервер репозитория и функциональность CA.

| ID         | Описание требования                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Приоритет |
|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------|
| **REPO‑15**| **Новая конечная точка: POST /request-cert** <br> • Принимает CSR (PEM) и имя шаблона (например, `server`) в JSON‑полезной нагрузке или как multipart/form‑data.<br> • Сервер **обязан** аутентифицировать запрос (простой API‑ключ или отсутствие аутентификации для демонстрации — но **обязан** документировать, что это небезопасно).<br> • Сервер **обязан** вызвать внутреннюю логику `ca issue-cert` с переданным CSR и шаблоном и вернуть выпущенный сертификат в формате PEM (либо ошибку).<br> • Ответ: `201 Created` с `Content-Type: application/x-pem-file` и телом сертификата.<br> • Данная конечная точка **обязана** быть интегрирована с существующей реализацией `ca issue-cert` с повторным использованием той же логики валидации, построения расширений и вставки в БД. | **Must**  |
| **REPO‑16**| **Аутентификация/авторизация:** Для целей спринта 6 конечная точка **может** использовать простой предварительно согласованный ключ, передаваемый в заголовке `X-API-Key`, либо вообще не требовать аутентификации, но с явным предупреждением. Студент **обязан** документально описать последствия такого подхода с точки зрения безопасности.                                                                                                                                                                                               | **Should** |
| **CA‑1**   | **Подпись CSR:** Команда `ca issue-cert` (и соответствующая библиотечная функция) **обязана** теперь принимать опциональный параметр CSR. Когда CSR предоставлен:<br> • Открытый ключ **обязательно** извлекается из CSR.<br> • Субъект **обязательно** берётся из CSR (переопределяет аргумент `--subject`).<br> • SAN **обязательно** берутся из расширения Subject Alternative Name в CSR (если присутствует), переопределяя флаги `--san`.<br> • Подпись CSR **обязательно** проверяется; при недействительной подписи выпуск сертификата **обязан** завершиться ошибкой.<br> • **Рекомендуется** проверять корректность CSR (размер ключа, алгоритм) на соответствие политике.   | **Must**  |

**Пример взаимодействия API (клиент → репозиторий):**

```bash
$ cat app.csr.pem | curl -X POST \
    -H "Content-Type: application/x-pem-file" \
    -H "X-API-Key: changeme" \
    --data-binary @- \
    http://localhost:8080/request-cert?template=server \
    --output app.cert.pem
```

---

## 6. Логирование и аудит

Клиентские операции и попытки проверки должны логироваться для обеспечения аудита.

| ID         | Описание требования                                                                                                                                                                                                                                                                                                                                                                                                                                 | Приоритет |
|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------|
| **LOG‑14** | **Логирование клиента:** Клиентский инструмент **должен** логировать все значимые операции (генерация CSR, запрос сертификата, попытки проверки) в локальный файл журнала (по умолч.: `~/.micropki/client.log`) или в stderr, если указан `--log-file`. <br> • Записи в журнале **обязаны** содержать временные метки, тип операции и результат.                                                                                                           | **Should** |
| **LOG‑15** | **Аудит проверки:** Механизм проверки путей **должен** уметь выдавать детализированный машиночитаемый вывод (JSON) при указании флага `--format json`. Это облегчает интеграцию с другими инструментами.                                                                                                                                                                                                                                                   | **Could**  |
| **LOG‑16** | **Логирование CA для запросов CSR:** CA **обязан** логировать все выпуски сертификатов, инициированные через конечную точку `/request-cert`, включая исходный IP‑адрес (если доступен) и факт обращения через API.                                                                                                                                                                                                                                      | **Must**   |

---

## 7. Тестирование и верификация

Реализация должна быть тщательно протестирована на позитивных и негативных сценариях, включая построение цепочки, проверку отзыва и сквозные клиентские сценарии.

| ID          | Описание требования                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Приоритет |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------|
| **TEST‑38** | **Тест генерации CSR:** Сгенерировать CSR командой `client gen-csr` и проверить, что:<br> • Закрытый ключ сохранён незашифрованным с правильными правами доступа.<br> • CSR содержит корректные субъект и SAN.<br> • Подпись CSR проверяется открытым ключом из закрытого ключа.                                                                                                                                                                                                                                         | **Must**  |
| **TEST‑39** | **Тест запроса сертификата:** Использовать сгенерированный CSR с командой `client request-cert` против запущенного репозитория/CA. Убедиться, что сертификат возвращён, сохранён, и что субъект и SAN в сертификате соответствуют CSR.                                                                                                                                                                                                                                                                               | **Must**  |
| **TEST‑40** | **Проверка цепочки – валидная цепочка:** Выпустить конечный сертификат, затем выполнить `client validate` с полной цепочкой. Инструмент **обязан** сообщить об успехе и перечислить все пройденные шаги проверки.                                                                                                                                                                                                                                                                                                     | **Must**  |
| **TEST‑41** | **Проверка цепочки – просроченный сертификат:** Выпустить сертификат с очень коротким сроком действия, дождаться его истечения (или использовать `--validation-time`) и выполнить проверку. Инструмент **обязан** сообщить об ошибке из‑за истечения срока действия.                                                                                                                                                                                                                                                   | **Must**  |
| **TEST‑42** | **Проверка цепочки – неверное использование ключа:** Выпустить клиентский сертификат, но попытаться проверить его как серверный (т.е. с проверкой расширенного использования ключа). Валидатор **может** опционально проверять EKU; этот тест рекомендуется, но не обязателен.                                                                                                                                                                                                                                       | **Could** |
| **TEST‑43** | **Проверка отзыва – только CRL:** Отозвать сертификат, сгенерировать CRL, затем использовать `client check-status` с `--crl`, указывающим на файл CRL. Инструмент **обязан** сообщить `revoked` с корректными причиной и датой.                                                                                                                                                                                                                                                                                     | **Must**  |
| **TEST‑44** | **Проверка отзыва – только OCSP:** Отозвать сертификат, запустить OCSP‑ответчик, затем использовать `client check-status` с OCSP (автоматически из AIA или вручную). Инструмент **обязан** сообщить `revoked`.                                                                                                                                                                                                                                                                                                       | **Must**  |
| **TEST‑45** | **Логика переключения при проверке отзыва:** <br> 1. Выпустить сертификат, отозвать его, но **не** запускать OCSP‑ответчик.<br> 2. Выполнить `client check-status` с включённым OCSP (и доступным CRL).<br> 3. Инструмент **обязан** переключиться на CRL и корректно сообщить `revoked`.<br> 4. В журнале **обязательно** должно быть указано о переключении.                                                                                                                                                           | **Should** |
| **TEST‑46** | **Построение цепочки – отсутствие промежуточного сертификата:** Проверить конечный сертификат без предоставления промежуточного. Если доверенный корень не может напрямую выпустить конечный сертификат (а он выпущен промежуточным), инструмент **обязан** не построить цепочку и сообщить об ошибке. При указании промежуточного через `--untrusted` цепочка должна успешно строиться.                                                                                                                             | **Must**  |
| **TEST‑47** | **Построение цепочки – множественные пути:** Создать сценарий с двумя перекрёстно подписанными промежуточными сертификатами (опционально, продвинутый уровень). Для спринта 6 не требуется.                                                                                                                                                                                                                                                                                                                         | **N/A**   |
| **TEST‑48** | **Сквозной интеграционный тест:** Выполнить полный клиентский сценарий:<br> 1. Запустить сервер репозитория (OCSP‑ответчик опционален).<br> 2. Сгенерировать CSR для серверного сертификата.<br> 3. Отправить CSR через `client request-cert`.<br> 4. Получить выпущенный сертификат.<br> 5. Проверить цепочку сертификатов с проверкой отзыва (OCSP/CRL).<br> 6. Отозвать сертификат.<br> 7. Повторно выполнить проверку; ожидается обнаружение отзыва.<br> Весь этот сценарий **рекомендуется** автоматизировать в едином тестовом скрипте. | **Should** |
| **TEST‑49** | **Негативный тест – недействительная подпись CSR:** Сгенерировать CSR, изменить в нём один байт, затем отправить в CA. CA **обязан** отклонить запрос с соответствующей ошибкой.                                                                                                                                                                                                                                                                                                                                     | **Should** |
| **TEST‑50** | **Негативный тест – неверный шаблон для CSR:** Отправить CSR, запрашивающий `CA=true` или содержащий недопустимые расширения. CA **обязан** переопределить их или отклонить. Проверяется применение политик (в спринте 7 это будет формализовано; в спринте 6 базовая проверка запрета `CA=true` в конечных сертификатах **обязательна**).                                                                                                                                                                           | **Should** |

---

## 8. Сводка обязательных технологических решений (дополнения для спринта 6)

| Компонент             | Требование (дополнения спринта 6)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Генерация CSR**     | • **Python:** `cryptography.x509.CertificateSigningRequestBuilder`.<br> • **Go:** `crypto/x509.CreateCertificateRequest`.<br> • Генерация закрытых ключей: аналогично спринту 2 (RSA‑2048/4096, ECC‑P256/P384).                                                                                                                                                                                                                                                                                                                                                                       |
| **Разбор CSR**        | • **Python:** `cryptography.x509.load_pem_x509_csr`.<br> • **Go:** `crypto/x509.ParseCertificateRequest` (и `ParsePKIXPublicKey`).                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Проверка пути**     | • **Python:** Реализовать с использованием `cryptography.x509.Certificate` и `cryptography.x509.Verifier`; построение цепочки — собственная реализация.<br> • **Go:** `crypto/x509.Certificate.Verify` можно использовать **только** для ознакомления/сравнения. Студент **обязан** реализовать свою упрощённую логику проверки пути — **не полагаться исключительно** на `Certificate.Verify` (который выполняет полное построение цепочки). Однако можно применять его для сверки. Основной акцент — понимание RFC 5280; поэтому механизм проверки должен быть написан самостоятельно с использованием структур сертификатов и методов проверки подписи. |
| **OCSP‑клиент**       | • **Python:** `cryptography.x509.ocsp.OCSPRequestBuilder`, библиотека `requests` для HTTP POST.<br> • **Go:** пакет `crypto/ocsp` для создания запроса и разбора ответа; `net/http` для отправки.                                                                                                                                                                                                                                                                                                                                                                                  |
| **CRL‑клиент**        | • **Python:** `cryptography.x509.load_pem_x509_crl` / `load_der_x509_crl`; `requests` для загрузки.<br> • **Go:** `crypto/x509.ParseRevocationList` (Go 1.19+).                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Разбор AIA / CDP**  | • **Python:** Извлечение URI OCSP из расширения `cryptography.x509.AuthorityInformationAccess`; CDP — из `cryptography.x509.CRLDistributionPoints`.<br> • **Go:** Доступ к полям `Certificate.OCSPServer` и `Certificate.CRLDistributionPoints`.                                                                                                                                                                                                                                                                                                                                      |
| **CLI**               | • Новая группа подкоманд `client` с подкомандами `gen-csr`, `request-cert`, `validate`, `check-status`.<br> • Команда `ca issue-cert` дополняется флагом `--csr`.                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Репозиторий**       | • Новая конечная точка `POST /request-cert`.<br> • Интеграция с существующей логикой выпуска сертификатов.                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Логирование**       | • Логирование на стороне клиента (файл или stderr).<br> • Логирование в CA для запросов, поступивших через API.                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Тестирование**      | • Модульные тесты для обработки CSR, построения цепочки, логики отзыва.<br> • Интеграционные тесты с использованием работающего репозитория и OCSP‑ответчика.                                                                                                                                                                                                                                                                                                                                                                                                                      |

---

**Окончание требований спринта 6**
*Все требования могут быть уточнены. В случае сомнений отдавайте предпочтение корректной логике проверки пути и надёжной проверке отзыва перед реализацией дополнительных возможностей, таких как ограничения на имена или обработка политик.*
