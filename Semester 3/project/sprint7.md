# **Project: MicroPKI - Technical Requirements Document (Sprint 7)**

**Sprint Goal:** Harden the PKI against operational threats by implementing comprehensive audit logging with cryptographic integrity, security controls (rate limiting, certificate transparency simulation, key compromise detection), and policy enforcement (key sizes, validity periods, SAN restrictions). All policy violations must be blocked and audited.

---

## 1. Project Structure & Repository Hygiene

The codebase must now incorporate audit modules, policy enforcement hooks, and supporting tools.

| ID     | Requirement Description                                                                                                                                                                                                                                                                                                                                                                                                                          | Priority |
|--------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| **STR‑22** | The repository **must** retain the structure from Sprints 1–6. New modules **must** be added for audit and security controls: <br> • **Python:** `audit.py`, `policy.py`, `ratelimit.py`, `transparency.py`, `compromise.py`.<br> • **Go:** `internal/audit/`, `internal/policy/`, `internal/ratelimit/`, `internal/transparency/`, `internal/compromise/`.                                                                                       | **Must** |
| **STR‑23** | The `README.md` **must** be updated with:<br> • Description of the audit system and how to verify log integrity.<br> • Configuration options for rate limiting, policy rules, and compromise simulation.<br> • Instructions for using the audit log query tool.<br> • Explanation of the Certificate Transparency (CT) simulation log.                                                                                                             | **Must** |
| **STR‑24** | A new configuration file format **should** be introduced (e.g., `micropki.yaml` or `config.toml`) to manage security policies, rate limits, audit settings, and CT log location. If implemented, the CLI **must** accept `--config` flag.                                                                                                                                                                                                        | **Should** |
| **STR‑25** | All security‑sensitive operations (issuance, revocation, key generation, policy overrides) **must** be logged to the audit system **before** execution and **after** completion (with outcome).                                                                                                                                                                                                                                                 | **Must** |

---

## 2. Command‑Line Interface (CLI) Parser

The CLI must provide commands to manage audit logs, query them, and simulate compromise events.

| ID     | Requirement Description                                                                                                                                                                                                                                                                                                                                                          | Priority |
|--------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| **CLI‑31** | The tool **must** provide a subcommand `audit query` that searches and displays audit log entries with filtering capabilities. <br> • **Arguments:** <br>   - `--from` – start timestamp (ISO 8601).<br>   - `--to` – end timestamp.<br>   - `--level` – log level (INFO, WARNING, ERROR, AUDIT).<br>   - `--operation` – filter by operation type (e.g., `issue`, `revoke`, `ca_init`).<br>   - `--serial` – filter by certificate serial.<br>   - `--format` – output format: `table` (default), `json`, `csv`.<br>   - `--verify` – verify the integrity hash chain of the retrieved logs (exit non‑zero if tampering detected).<br> • If no database/file is specified, the tool **must** use the default audit log location (e.g., `./pki/audit/audit.log`). | **Must** |
| **CLI‑32** | The tool **must** provide a subcommand `audit verify` that performs a full integrity check of the entire audit log, rebuilding and verifying the hash chain. <br> • **Arguments:** <br>   - `--log-file` – path to audit log (default: `./pki/audit/audit.log`).<br>   - `--chain-file` – path to stored hash chain file (default: `./pki/audit/chain.dat`). <br> • The tool **must** report whether the log has been tampered with and, if possible, identify the first corrupted entry.                                                                                     | **Must** |
| **CLI‑33** | The tool **must** provide a subcommand `ca compromise` that simulates private key compromise for testing purposes. <br> • **Arguments:** <br>   - `--cert` – path to certificate whose private key is compromised.<br>   - `--reason` – reason code (default: `keyCompromise`).<br>   - `--force` – skip confirmation.<br> • This command **must**:<br>   - Mark the certificate as `compromised` in the database (a new field, or reuse `revoked` with reason `keyCompromise`).<br>   - Immediately revoke the certificate.<br>   - Generate a high‑severity audit log entry.<br>   - Optionally, trigger an emergency CRL update. | **Must** |
| **CLI‑34** | The `repo serve` and `ocsp serve` commands **must** be extended to support optional **rate limiting**. <br> • New flags:<br>   - `--rate-limit` – requests per second per client IP (default: `0` = disabled).<br>   - `--rate-burst` – burst allowance (default: `10`).<br> • The rate limiter **must** apply to all HTTP endpoints (certificate fetch, CRL, OCSP, request‑cert). <br> • When a client exceeds the rate limit, the server **must** respond with `429 Too Many Requests` and a `Retry-After` header.                                                                 | **Should** |
| **CLI‑35** | The existing `ca issue-cert` and `ca issue-intermediate` commands **must** enforce the security policies defined in Section 5. If a policy violation occurs, issuance **must** be aborted, an audit log entry **must** be created, and an error **must** be returned.                                                                                                                                                                            | **Must** |

**Example invocations:**

```bash
# 1. Query audit logs for all certificate issuances in the last 24 hours
$ micropki audit query \
    --from $(date -d 'yesterday' -Iseconds) \
    --operation issue \
    --format table

# 2. Verify the integrity of the entire audit log
$ micropki audit verify --log-file ./pki/audit/audit.log

# 3. Simulate compromise of a server certificate
$ micropki ca compromise --cert ./pki/certs/example.com.cert.pem --reason keyCompromise

# 4. Start repository server with rate limiting enabled
$ micropki repo serve \
    --host 0.0.0.0 \
    --port 8080 \
    --rate-limit 5 \
    --rate-burst 10
```

---

## 3. Core PKI Implementation (Policy Enforcement)

The CA must enforce strict policies regarding key sizes, validity periods, and SAN restrictions. All violations must be blocked and audited.

| ID     | Requirement Description                                                                                                                                                                                                                                                                                                                                                                                                                                      | Priority |
|--------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| **POL‑3** | **Key Size Enforcement:** <br> • For **RSA keys**:<br>   - Root CA: minimum 4096 bits (REQUIRED).<br>   - Intermediate CA: minimum 3072 bits (recommended) or 4096 (preferred). **Must** reject keys < 2048 bits for any CA or end‑entity.<br>   - End‑entity: minimum 2048 bits. Reject any CSR or internal key generation with key size < 2048.<br> • For **ECC keys**:<br>   - Root/Intermediate: minimum P‑384 (secp384r1). Reject P‑256 for Root/Intermediate.<br>   - End‑entity: minimum P‑256 (secp256r1). P‑384 also allowed.<br> • These checks **must** be performed both when generating keys internally and when processing external CSRs. | **Must** |
| **POL‑4** | **Validity Period Enforcement:** <br> • **Root CA certificates:** maximum validity **10 years** (3650 days). If `--validity-days` exceeds this, issuance **must** fail.<br> • **Intermediate CA certificates:** maximum validity **5 years** (1825 days).<br> • **End‑entity certificates:** maximum validity **1 year** (365 days).<br> • The tool **must** reject any issuance request (internal or CSR) that requests a longer validity than the maximum allowed.                                                                                                                              | **Must** |
| **POL‑5** | **SAN Validation & Restrictions:** <br> • **Wildcard certificates:** For server certificates, wildcard SAN entries (e.g., `dns:*.example.com`) **must** be rejected if the certificate is intended for critical systems. The policy **must** be configurable; by default, wildcards **should** be **rejected** with a clear error.<br> • **Forbidden SAN types per template:** <br>   - `server` – only `dns` and `ip` allowed. `email`, `uri` not allowed.<br>   - `client` – `email` and `dns` allowed; `ip` and `uri` discouraged but allowed? **Should** enforce `client` can have `email` at least; `dns` optional.<br>   - `code_signing` – `dns` and `uri` allowed; `ip`, `email` not allowed.<br> • The CA **must** verify that the CSR's SAN extensions comply with the template policy; if not, issuance **must** fail. | **Must** |
| **POL‑6** | **Algorithm and Hash Enforcement:** <br> • **Signature algorithms:** <br>   - RSA keys: **must** use SHA‑256 or stronger (SHA‑384, SHA‑512). SHA‑1 **must** be rejected.<br>   - ECC keys: **must** use SHA‑384 for P‑384, SHA‑256 for P‑256.<br> • The CA **must** verify that the CSR's signature algorithm meets these requirements; if not, reject.                                                                                                                                                                           | **Must** |
| **POL‑7** | **Path Length Constraint Enforcement:** <br> • Root CA: no path length constraint (or explicitly set to `None`).<br> • Intermediate CA: path length constraint **must** be `0` (cannot issue further CAs) unless explicitly overridden (which should be discouraged).<br> • The tool **must** reject issuance of an Intermediate CA certificate with pathLen > 0 unless `--allow-subordinate` flag is used (not implemented; thus must enforce pathLen = 0).                                                                                                                              | **Must** |
| **POL‑8** | **Configuration Overrides:** The tool **should** support a policy configuration file that allows an administrator to relax or tighten certain policies (e.g., allow wildcards, adjust max validity). This is **optional** for Sprint 7 but recommended.                                                                                                                                                                                                      | **Could** |

---

## 4. Audit System & Log Integrity

A robust audit system must record all security‑sensitive events and provide cryptographic integrity guarantees via hash chaining.

| ID     | Requirement Description                                                                                                                                                                                                                                                                                                                                                                                                                                      | Priority |
|--------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| **AUD‑1** | **Structured JSON Logging:** All audit logs **must** be written in newline‑delimited JSON (NDJSON) format, with each event as a single JSON object. The log file **must** be append‑only (as far as possible) and stored in a dedicated `audit` subdirectory under `--out-dir` (default: `./pki/audit/audit.log`). <br> • Each log entry **must** contain at least:<br>   - `timestamp` (ISO 8601 with microseconds).<br>   - `level` (e.g., `"AUDIT"`, `"INFO"`, `"ERROR"`).<br>   - `operation` (string, e.g., `"issue_certificate"`).<br>   - `status` (`"success"` or `"failure"`).<br>   - `message` (human‑readable).<br>   - `metadata` (object containing operation‑specific fields: serial, subject, reason, client IP, etc.).<br>   - `integrity` (object containing `prev_hash`, `hash`). | **Must** |
| **AUD‑2** | **Hash Chain Integrity:** <br> • Each audit log entry **must** contain an `integrity` field with:<br>   - `prev_hash`: SHA‑256 hash of the previous log entry (as a complete JSON string). For the first entry, `prev_hash = "0"*64`.<br>   - `hash`: SHA‑256 hash of the **current entry's content excluding the `integrity.hash` field itself**. The calculation **must** be performed over the canonical JSON representation (sorted keys, no extra whitespace).<br> • The tool **must** maintain a separate, append‑only `chain.dat` file that stores only the latest hash (or the full chain of hashes) to allow efficient verification.                                                                                              | **Must** |
| **AUD‑3** | **Audit Log Verification:** The `audit verify` command **must** recompute the hash chain for the entire log file and compare it with the stored `chain.dat`. Any mismatch **must** be reported as a security breach. The tool **must** also detect missing entries, reordered entries, or modified content.                                                                                                                                                  | **Must** |
| **AUD‑4** | **Mandatory Audit Events:** At minimum, the following operations **must** generate AUDIT‑level log entries (level: `"AUDIT"`): <br> • CA initialisation (Root/Intermediate).<br> • Certificate issuance (including via CSR).<br> • Certificate revocation (including compromise simulation).<br> • CRL generation.<br> • OCSP responder startup/shutdown.<br> • Policy violation attempts (blocked issuance).<br> • Private key compromise (simulated).<br> • Configuration changes (if config file is supported).                                                                              | **Must** |
| **AUD‑5** | **Audit Log Rotation:** The audit system **should** support basic log rotation (e.g., closing and reopening the log file on `SIGUSR1` or a size limit). This is **optional** but recommended.                                                                                                                                                                                                                                                                | **Could** |
| **AUD‑6** | **Tamper Evidence:** If the hash chain verification fails, any subsequent security‑sensitive operations (issuance, revocation) **should** be blocked until an administrator resolves the issue. This is a **Should** (recommended but not mandatory for this sprint).                                                                                                                                                                                         | **Should** |

**Example audit log entry (JSON):**
```json
{
  "timestamp": "2026-02-13T15:04:05.123456Z",
  "level": "AUDIT",
  "operation": "issue_certificate",
  "status": "success",
  "message": "Issued server certificate for CN=example.com",
  "metadata": {
    "serial": "2A7F8B3C...",
    "subject": "CN=example.com,O=MicroPKI",
    "template": "server",
    "requester": "127.0.0.1"
  },
  "integrity": {
    "prev_hash": "abc123...",
    "hash": "def456..."
  }
}
```

---

## 5. Security Controls

Additional operational security controls must be implemented: rate limiting, certificate transparency simulation, and compromise detection.

| ID     | Requirement Description                                                                                                                                                                                                                                                                                                                                                                                                                                      | Priority |
|--------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| **CTL‑1** | **Rate Limiting:** As described in CLI‑34, the repository and OCSP servers **must** support rate limiting per client IP. <br> • Implementation **must** use a token bucket or sliding window algorithm.<br> • Rate limit configuration **should** be adjustable via command line flags or configuration file.<br> • When rate limit is exceeded, respond with HTTP 429 and a `Retry-After` header (in seconds). <br> • The rate limiter **must** be thread‑safe (if using multi‑threaded server).                                     | **Should** |
| **CTL‑2** | **Certificate Transparency (CT) Simulation:** <br> • The tool **must** maintain an append‑only, plain‑text file that acts as a **Certificate Transparency log** (simulated). The file **must** be named `ct.log` and stored in the `audit` directory.<br> • For every certificate issued, a line **must** be appended containing:<br>   - Timestamp (ISO 8601).<br>   - Certificate serial (hex).<br>   - Subject DN.<br>   - SHA‑256 fingerprint of the certificate.<br>   - Optional: issuer DN.<br> • This log **must** be publicly readable (permissions `0o644`) – it is **not** confidential.<br> • The tool **should** provide a command `audit ct-verify` that checks whether a given certificate appears in the log (proof of inclusion). Since it's a simple text file, this is just `grep`. | **Must** |
| **CTL‑3** | **Private Key Compromise Simulation:** <br> • The `ca compromise` command (CLI‑33) **must** immediately revoke the certificate with reason `keyCompromise`.<br> • Additionally, the tool **must** mark the associated private key as compromised in a new database table (`compromised_keys`) or via a new field in the certificates table.<br> • The tool **should** also trigger an **emergency CRL update** (i.e., generate a new CRL immediately).<br> • A high‑severity audit log entry **must** be created.                                                                               | **Must** |
| **CTL‑4** | **Compromised Key Blocking:** If a private key is marked as compromised, any future CSR using the same public key (i.e., same modulus for RSA, same curve point for ECC) **must** be rejected by the CA. The tool **must** check the database of compromised keys before issuance.                                                                                                                                                                            | **Should** |
| **CTL‑5** | **Intrusion Detection Simulation:** The tool **should** provide a command `audit detect-anomalies` that performs simple heuristic analysis on the audit log (e.g., sudden spike in issuance, revocations, etc.). This is **optional** and can be simple (e.g., count events per hour and warn if > threshold).                                                                                                                                              | **Could** |

---

## 6. Database Extensions

The database schema must be extended to support compromise tracking and audit metadata.

| ID     | Requirement Description                                                                                                                                                                                                                                                                                                                                                                                                                                      | Priority |
|--------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| **DB‑10** | **New Table: `compromised_keys`** <br> To support compromise simulation and blocking, the following table **should** be created:                                                                                                                                                                                                                                                                                                                             | **Should** |

```sql
CREATE TABLE compromised_keys (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    public_key_hash TEXT UNIQUE NOT NULL,   -- SHA‑256 of the public key (DER) for fast lookup
    certificate_serial TEXT NOT NULL,       -- serial of the revoked certificate
    compromise_date TEXT NOT NULL,          -- ISO 8601
    compromise_reason TEXT NOT NULL,        -- reason string
    FOREIGN KEY (certificate_serial) REFERENCES certificates(serial_hex)
);
```

| ID     | Requirement Description                                                                                                                                                                                                                                                                                                                                                                                                                                      | Priority |
|--------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| **DB‑11** | **Audit Log Table (Optional):** The audit log is file‑based, not database‑based. No new database table for audit entries is required. The `chain.dat` file is separate.                                                                                                                                                                                                                                                                                      | **N/A**  |
| **DB‑12** | **Migration:** The `db init` command **must** create the `compromised_keys` table if it does not exist. The student **should** provide a migration script for existing databases (or document that a fresh database is required).                                                                                                                                                                                                                             | **Should** |

---

## 7. Logging & Audit (Enhancements)

The existing logging framework must be upgraded to support the new audit system.

| ID     | Requirement Description                                                                                                                                                                                                                                                                                                                                                                                                                      | Priority |
|--------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| **LOG‑17**| **Audit Logger:** A dedicated audit logger **must** be implemented that writes NDJSON to the audit log file with hash chaining. This logger **must** be separate from the application logger (which writes plain text to stderr/file).                                                                                                                                                                                                        | **Must** |
| **LOG‑18**| **Sensitive Data Reduction:** The audit logger **must never** log private keys, passphrases, or any secret material. Certificate public keys are acceptable.                                                                                                                                                                                                                                                                                  | **Must** |
| **LOG‑19**| **Log Initialisation:** When the application starts (CLI or server), the audit system **must** be initialised. If the audit log file does not exist, it **must** be created with the first entry having `prev_hash = "0"*64`.                                                                                                                                                                                                                   | **Must** |

---

## 8. Testing & Verification

The hardened PKI must be tested against policy violations and the integrity of the audit system must be proven.

| ID     | Requirement Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Priority |
|--------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| **TEST‑51** | **Policy Violation – Weak Key Size:** Attempt to issue an end‑entity certificate with an RSA‑1024 key (or generate CSR with 1024-bit key). The CA **must** reject the request with an error, and an AUDIT log entry **must** be created.                                                                                                                                                                                                                                                                                               | **Must** |
| **TEST‑52** | **Policy Violation – Excessive Validity:** Attempt to issue a leaf certificate with validity > 365 days. The CA **must** reject the request.                                                                                                                                                                                                                                                                                                                                                                                         | **Must** |
| **TEST‑53** | **Policy Violation – Wildcard SAN:** Attempt to issue a server certificate with SAN `dns:*.example.com`. The CA **must** reject (by default policy).                                                                                                                                                                                                                                                                                                                                                                                  | **Must** |
| **TEST‑54** | **Policy Violation – Forbidden SAN Type:** Attempt to issue a code‑signing certificate with an `email` SAN. The CA **must** reject.                                                                                                                                                                                                                                                                                                                                                                                                  | **Must** |
| **TEST‑55** | **Audit Integrity – Tamper Detection:** <br> 1. Generate several audit log entries (issuances, revocations).<br> 2. Manually modify one byte in the audit log file (using a hex editor or script).<br> 3. Run `micropki audit verify` – the tool **must** detect the tampering and exit with non‑zero status.                                                                                                                                                                                                                            | **Must** |
| **TEST‑56** | **Audit Integrity – Chain Continuity:** <br> 1. Create audit log entries A, B, C.<br> 2. Delete entry B.<br> 3. Run `audit verify` – the tool **must** detect the missing entry (hash mismatch between A and C).                                                                                                                                                                                                                                                                                                                      | **Should** |
| **TEST‑57** | **Compromise Simulation & Blocking:** <br> 1. Issue a certificate (Serial X).<br> 2. Run `micropki ca compromise --cert cert.pem`.<br> 3. Verify that the certificate status is `revoked` with reason `keyCompromise`.<br> 4. Verify that the `compromised_keys` table contains the public key hash.<br> 5. Generate a CSR using the **same** private key and attempt to issue a new certificate. The CA **must** reject the request (key compromised).                                                                                       | **Should** |
| **TEST‑58** | **Rate Limiting Test:** <br> 1. Start repository server with `--rate-limit 1 --rate-burst 2`.<br> 2. Send 5 rapid requests to `/ca/root`.<br> 3. At least the 4th and 5th requests **must** receive HTTP 429 status.<br> 4. Logging **must** indicate rate limit exceeded.                                                                                                                                                                                                                                                            | **Should** |
| **TEST‑59** | **Certificate Transparency Log Test:** <br> 1. Issue a certificate.<br> 2. Verify that an entry was appended to `ct.log`.<br> 3. Run `grep` to confirm the serial appears.                                                                                                                                                                                                                                                                                                                                                           | **Must** |
| **TEST‑60** | **Full Security Hardening Integration Test:** <br> A single automated script that:<br> • Starts repository with rate limiting.<br> • Attempts multiple policy violations – all blocked and audited.<br> • Issues a valid certificate, logs to CT, audit trail intact.<br> • Simulates key compromise, triggers emergency CRL, blocks re‑issuance.<br> • Verifies audit log integrity before and after tampering attempt.<br> • Demonstrates that the system is hardened against basic attacks.                                             | **Should** |

---

## 9. Summary of Mandatory Technical Stack Choices (Sprint 7 Additions)

| Component             | Requirement (Sprint 7 additions)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Audit Logging**     | • **Format:** NDJSON (newline‑delimited JSON).<br> • **Hash Chain:** SHA‑256, linking each entry to the previous.<br> • **Library:** Use standard JSON library (`json` in Python, `encoding/json` in Go).<br> • **File I/O:** Append‑only writes; file locking recommended (fcntl/flock or advisory).                                                                                                                                                                                                                                                                                          |
| **Policy Enforcement**| • Key size checks: implemented in CSR processing and key generation.<br> • Validity period checks: compare `--validity-days` with configured max.<br> • SAN type checks: validate each SAN against allowed types per template.<br> • Wildcard detection: reject if `*.` pattern present (configurable).<br> • No external policy engine required; all checks are hard‑coded or config‑file driven.                                                                                                                                                                                            |
| **Rate Limiting**     | • **Python:** `flask-limiter` (if using Flask) or implement token bucket manually with `time` and `collections.deque`.<br> • **Go:** `golang.org/x/time/rate` package (token bucket) or manual implementation with `sync.Map` and timers.<br> • Must support per‑client IP limiting.                                                                                                                                                                                                                                                                                                         |
| **CT Simulation**     | • Simple text file, append‑only.<br> • No Merkle trees; no cryptographic proofs (simulation only).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Compromise Simulation** | • New CLI command `ca compromise`.<br> • Database table `compromised_keys`.<br> • Public key hashing: SHA‑256 of DER‑encoded SPKI.                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **CLI**               | • `audit query` and `audit verify` subcommands.<br> • `ca compromise` subcommand.<br> • New flags for rate limiting on `serve` commands.                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Configuration**     | • Optional YAML/TOML/JSON configuration file.<br> • If implemented, must be documented in README.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Testing**           | • Automated tests for policy rejection, audit integrity, rate limiting, compromise blocking.<br> • Use of temporary files/directories for audit log and CT log in tests.                                                                                                                                                                                                                                                                                                                                                                                                                      |

---

**End of Sprint 7 Requirements**
*All requirements are subject to clarification. When in doubt, prioritise audit log integrity and policy enforcement over advanced features like configurable policies or anomaly detection.*
