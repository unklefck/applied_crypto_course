### **Проект: CryptoSafe Manager — Техническое задание (Спринт 1)**

**Цель спринта:** Создать безопасный, расширяемый фундамент с зашифрованной базой данных, модульной архитектурой и базовой оболочкой графического интерфейса для поддержки всех последующих спринтов.

#### **1. Архитектура проекта и структура репозитория**

Фундамент должен быть модульным и расширяемым, чтобы поддерживать все 8 спринтов без серьезного рефакторинга.

| ID  | Описание требования                                                                                                 | Приоритет |
| :-- | :------------------------------------------------------------------------------------------------------------------ | :------- |
| ARC-1 | Кодовая база **обязана** следовать разделению Model-View-Controller (MVC) или аналогичному:                         | Must     |
|      | - `src/core/` – Криптографическая и бизнес-логика                                                                   |          |
|      | - `src/gui/` – Компоненты пользовательского интерфейса и окна                                                       |          |
|      | - `src/database/` – Модели и схемы базы данных                                                                      |          |
|      | - `tests/` – Модульные и интеграционные тесты                                                                       |          |
| ARC-2 | Должен быть реализован менеджер конфигураций (`src/core/config.py`) для обработки:                                 | Must     |
|      | - Пути к базе данных, настроек шифрования, пользовательских предпочтений                                            |          |
|      | - Будущих настроек (таймаут буфера обмена, авто-блокировка и т.д.)                                                  |          |
| ARC-3 | Файл `README.md` **обязан** содержать:                                                                              | Must     |
|      | - Полное описание видения проекта и дорожную карту спринтов (ссылка на все 8 спринтов)                              |          |
|      | - Инструкции по настройке с указаниями по созданию виртуального окружения                                           |          |
|      | - Диаграмму обзора архитектуры (поток MVC)                                                                          |          |

#### **2. Схема базы данных с учетом будущего расширения**

База данных должна поддерживать текущие потребности, оставаясь расширяемой для журнала аудита, тегов, корзины и безопасного обмена.

| ID  | Описание требования                                                                                                 | Приоритет |
| :-- | :------------------------------------------------------------------------------------------------------------------ | :------- |
| DB-1 | База данных SQLite **обязана** включать следующие таблицы с соответствующими индексами:                             | Must     |
|      | - `vault_entries`: id, title, username, encrypted_password, url, notes, created_at, updated_at, tags               |          |
|      | - `audit_log`: id, action, timestamp, entry_id, details, signature (заглушка для Спринта 5)                         |          |
|      | - `settings`: id, setting_key, setting_value, encrypted (логический)                                               |          |
|      | - `key_store`: id, key_type, salt, hash, params (для управления ключами в Спринте 2)                                |          |
| DB-2 | Все конфиденциальные поля **обязаны** шифроваться **перед** вставкой с использованием заглушки сервиса шифрования. | Must     |
| DB-3 | Помощник базы данных (`src/database/db.py`) **обязан** предоставлять:                                               | Must     |
|      | - Пул соединений и потокобезопасность                                                                               |          |
|      | - Структуру, готовую к миграциям (с использованием `sqlite3` pragma user_version)                                   |          |
| DB-4 | Механизм резервного копирования/восстановления **должен** быть создан в виде заглушки для Спринта 8.                | Should   |

#### **3. Криптографический фундамент и сервисы-заглушки**

Сервисы шифрования должны быть абстрагированы для обеспечения бесшовного обновления в последующих спринтах.

| ID  | Описание требования                                                                                                 | Приоритет |
| :-- | :------------------------------------------------------------------------------------------------------------------ | :------- |
| CRY-1 | Абстрактный класс `EncryptionService` **обязан** быть создан в `src/core/crypto/abstract.py` с методами:            | Must     |
|      | - `encrypt(data: bytes, key: bytes) → bytes`                                                                       |          |
|      | - `decrypt(ciphertext: bytes, key: bytes) → bytes`                                                                 |          |
| CRY-2 | Класс-заглушка `AES256Placeholder` **обязан** реализовывать абстрактный сервис, используя простое XOR для Спринта 1, с последующей заменой на реальный AES-GCM в Спринте 3. | Must     |
| CRY-3 | Заглушка `KeyManager` **обязана** быть создана в `src/core/key_manager.py` с методами для:                         | Must     |
|      | - `derive_key(password: str, salt: bytes) → bytes` (заглушка)                                                       |          |
|      | - `store_key()` и `load_key()` (для интеграции в Спринте 2)                                                         |          |
| CRY-4 | Безопасное управление памятью **обязано** использовать `ctypes` или `secrets` для обнуления конфиденциальных данных после использования. | Must     |

#### **4. Оболочка графического интерфейса с расширяемыми виджетами**

Графический интерфейс должен быть построен на переиспользуемых компонентах для поддержки буфера обмена, просмотра логов, импорта/экспорта и настроек.

| ID  | Описание требования                                                                                                 | Приоритет |
| :-- | :------------------------------------------------------------------------------------------------------------------ | :------- |
| GUI-1 | Главное окно **обязано** быть построено с использованием фреймворка (Tkinter/PyQt) и содержать:                     | Must     |
|      | - Панель меню: Файл (Создать, Открыть, Резервная копия, Выход), Правка (Добавить, Изменить, Удалить), Вид (Логи, Настройки), Справка |          |
|      | - Центральный виджет таблицы с тестовыми данными                                                                    |          |
|      | - Строку состояния с отображением статуса входа и заглушкой таймера буфера обмена                                    |          |
| GUI-2 | Переиспользуемые компоненты интерфейса **обязаны** располагаться в `src/gui/widgets/`:                              | Must     |
|      | - `PasswordEntry` (поле ввода с маскировкой и кнопкой показа)                                                       |          |
|      | - `SecureTable` (для записей хранилища)                                                                             |          |
|      | - `AuditLogViewer` (заглушка для Спринта 5)                                                                         |          |
| GUI-3 | Мастер первоначальной настройки **обязан** включать:                                                                | Must     |
|      | - Создание мастер-пароля с подтверждением                                                                           |          |
|      | - Выбор расположения базы данных                                                                                    |          |
|      | - Настройки шифрования (заглушка для параметров формирования ключа)                                                |          |
| GUI-4 | Диалог настроек в виде заглушки **должен** быть создан со вкладками для:                                            | Should   |
|      | - Безопасность (таймаут буфера, авто-блокировка)                                                                    |          |
|      | - Внешний вид (тема, язык)                                                                                          |          |
|      | - Дополнительно (резервное копирование, экспорт)                                                                    |          |

#### **5. Система событий и основа для журнала аудита**

Должна быть реализована шина событий для разделения компонентов и подготовки к ведению журнала аудита.

| ID  | Описание требования                                                                                                 | Приоритет |
| :-- | :------------------------------------------------------------------------------------------------------------------ | :------- |
| EVT-1 | Система событий (`src/core/events.py`) **обязана** быть реализована для публикации/подписки на:                     | Must     |
|      | - `EntryAdded`, `EntryUpdated`, `EntryDeleted`                                                                      |          |
|      | - `UserLoggedIn`, `UserLoggedOut`                                                                                   |          |
|      | - `ClipboardCopied`, `ClipboardCleared` (для Спринта 4)                                                              |          |
| EVT-2 | Заглушки журнала аудита **обязаны** подписываться на соответствующие события и записывать тестовые записи в лог.    | Must     |
| EVT-3 | Система событий **должна** поддерживать как синхронную, так и асинхронную обработку.                                | Should   |

#### **6. Конфигурация и управление состоянием**

Централизованный менеджер состояния должен отслеживать состояние приложения для авто-блокировки, буфера обмена и пользовательской сессии.

| ID  | Описание требования                                                                                                 | Приоритет |
| :-- | :------------------------------------------------------------------------------------------------------------------ | :------- |
| CFG-1 | Класс `StateManager` **обязан** отслеживать:                                                                        | Must     |
|      | - Текущую пользовательскую сессию (заблокировано/разблокировано)                                                     |          |
|      | - Содержимое буфера обмена и таймер (для Спринта 4)                                                                  |          |
|      | - Таймер неактивности (для авто-блокировки в Спринте 7)                                                               |          |
| CFG-2 | Все настройки **обязаны** храниться в таблице `settings` с шифрованием для конфиденциальных опций.                  | Must     |
| CFG-3 | Должна поддерживаться загрузка конфигураций для разных окружений (разработка/продакшн).                             | Should   |

#### **7. Инфраструктура тестирования**

Тестирование должно быть настроено с самого начала для поддержки непрерывной интеграции во всех спринтах.

| ID  | Описание требования                                                                                                 | Приоритет |
| :-- | :------------------------------------------------------------------------------------------------------------------ | :------- |
| TEST-1 | Модульные тесты **обязаны** покрывать:                                                                              | Must     |
|      | - Подключение к базе данных и схему                                                                                 |          |
|      | - Шифрование/расшифрование с использованием заглушек                                                                |          |
|      | - Публикацию событий в системе событий                                                                              |          |
| TEST-2 | Интеграционные тесты **обязаны** проверять:                                                                         | Must     |
|      | - Процесс первоначальной настройки                                                                                  |          |
|      | - Корректный запуск главного окна                                                                                   |          |
|      | - Загрузку конфигурации                                                                                             |          |
| TEST-3 | Фикстура тестовой базы данных **обязана** быть подготовлена для всех будущих спринтов.                              | Must     |
| TEST-4 | Покрытие кода тестами **должно** быть ≥ 70% для основных модулей.                                                   | Should   |

#### **8. Безопасность и соответствие требованиям**

Лучшие практики безопасности должны быть заложены с самого начала.

| ID  | Описание требования                                                                                                 | Приоритет |
| :-- | :------------------------------------------------------------------------------------------------------------------ | :------- |
| SEC-1 | В исходном коде не должно быть жестко закодированных секретов или ключей.                                           | Must     |
| SEC-2 | Весь пользовательский ввод должен валидироваться и очищаться.                                                       | Must     |
| SEC-3 | Сообщения об ошибках не должны раскрывать конфиденциальную информацию.                                              | Must     |
| SEC-4 | Приложение должно запускаться с минимально необходимыми правами доступа к файлам.                                  | Should   |

#### **9. Подготовка к сборке и развертыванию**

Проект должен быть подготовлен к финальной сборке с первого дня.

| ID  | Описание требования                                                                                                 | Приоритет |
| :-- | :------------------------------------------------------------------------------------------------------------------ | :------- |
| DEP-1 | Файл `requirements.txt` или `pyproject.toml` **обязан** содержать список всех зависимостей с указанием версий.      | Must     |
| DEP-2 | `Dockerfile` или скрипт сборки в виде заглушки **должен** быть создан для упаковки в Спринте 8.                      | Should   |
| DEP-3 | Должна быть настроена конфигурация GitHub Actions или CI для запуска тестов при отправке кода.                     | Should   |

---

**Пример модульной структуры:**
```
cryptosafe-manager/
├── src/
│   ├── core/
│   │   ├── crypto/
│   │   │   ├── abstract.py       # EncryptionService
│   │   │   └── placeholder.py    # AES256Placeholder (заглушка)
│   │   ├── events.py             # Система событий
│   │   ├── config.py             # Конфигурация
│   │   └── state_manager.py      # Управление состоянием
│   ├── database/
│   │   ├── models.py             # Модели SQLAlchemy или обычные SQL-модели
│   │   └── db.py                 # Помощник БД
│   └── gui/
│       ├── main_window.py        # Основной UI
│       └── widgets/              # Переиспользуемые компоненты
├── tests/
│   ├── test_crypto.py
│   └── test_database.py
├── README.md
├── requirements.txt
└── .github/workflows/tests.yml
```
